<div class="boardModal modal" id="boardModal">
    <!-- Ï§ëÏïôÏóê ÏûëÍ≤å ÌëúÏãúÎêòÎèÑÎ°ù ÏàòÏ†ï -->
    <div class="bmodal-board-modal-content modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="boardModalLabel">Ïù¥Î≤§Ìä∏ Í≥µÏßÄ</h5>
            <button type="button" class="btn-close" id="closeModalBtn" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <!-- Î™®Îã¨ ÎÇ¥Ïö©Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê† Î∂ÄÎ∂Ñ -->
        </div>
    </div>
</div>

<div class="content-box">
    {{#modal.boards}}
        <div class="group-name">{{socialName}}</div>
        <div class="post">
            <div class="author-box">
                <img src="{{userImage}}" alt="Profile Picture" class="profile-picture openModalBtn"
                     data-board-id="{{boardId}}">
                <div>
                    <button data-board-id="{{boardId}}" class="book-button {{#book}}book{{/book}}">
                        <i class="fas fa-star"></i>
                    </button>
                    <div class="author">{{nickname}}</div>
                    <div class="date">{{createdAt}}</div>
                </div>
            </div>
            <div class="message-box">
                {{#albums}}
                    <div class="media-item">
                        {{#isImage}}
                            <img src="{{path}}" alt="Image"
                                 style="max-width: 100%; max-height: 300px; margin-bottom: 10px;">
                        {{/isImage}}
                        {{#isVideo}}
                            <video controls style="max-width: 100%; max-height: 300px;">
                                <source src="{{path}}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {{/isVideo}}
                    </div>
                {{/albums}}
                <div class="message openModalBtn" data-board-id="{{boardId}}">
                    {{{content}}}
                </div>
                {{^hashEmpty}}
                    <div class="media-box">
                        <div class="hashtag-box">
                            {{#hashtagList}}
                                <button class="hashtag-btn">{{name}}</button>
                            {{/hashtagList}}
                        </div>
                    </div>
                {{/hashEmpty}}
                <div class="comments">
                    <div class="like-count">üòäüòçÏ¢ãÏïÑÏöî <span class="like-count-value">{{likeCount}}</span></div>
                    <div class="comment-count">üí¨ÎåìÍ∏Ä {{replyCount}}</div>
                </div>
            </div>
        </div>
        <div class="comment-section-container">
            <button class="like-button {{#liked}}liked{{/liked}}" data-board-id="{{boardId}}">
                <i class="fas fa-heart"></i>
            </button>

            <form action="/reply/save" method="post">
                <div class="d-flex">

                    <div class="comment-section">
                        <input type="hidden" name="socialId" value="{{socialId}}">
                        <input type="hidden" name="boardId" value="{{boardId}}">
                        <img src="{{myProfileImage}}" alt="Commenter Picture" class="comment-picture">
                        <input type="text" name="comment" placeholder="ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî.">
                    </div>
                    <div>
                        <button type="submit" class="send-button">Î≥¥ÎÇ¥Í∏∞</button>
                    </div>

                </div>
            </form>

        </div>
    {{/modal.boards}}

    {{#modals.boards}}
        <div class="group-name">{{socialName}}</div>
        <div class="post">
            <div class="author-box">
                <img src="{{userImage}}" alt="Profile Picture" class="profile-picture openModalBtn"
                     data-board-id="{{boardId}}">
                <div>
                    <button data-board-id="{{boardId}}" class="book-button {{#book}}book{{/book}}">
                        <i class="fas fa-star" style="color: yellow"></i>
                    </button>
                    <div class="author">{{nickname}}</div>
                    <div class="date">{{createdAt}}</div>
                </div>
            </div>
            <div class="message-box">
                {{#albums}}
                    <div class="media-item">
                        {{#isImage}}
                            <img src="{{path}}" alt="Image"
                                 style="max-width: 100%; max-height: 300px; margin-bottom: 10px;">
                        {{/isImage}}
                        {{#isVideo}}
                            <video controls style="max-width: 100%; max-height: 300px;">
                                <source src="{{path}}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {{/isVideo}}
                    </div>
                {{/albums}}
                <div class="message openModalBtn" data-board-id="{{boardId}}">
                    {{{content}}}
                </div>
                {{^hashEmpty}}
                    <div class="media-box">
                        <div class="hashtag-box">
                            {{#hashtagList}}
                                <button class="hashtag-btn">{{name}}</button>
                            {{/hashtagList}}
                        </div>
                    </div>
                {{/hashEmpty}}
                <div class="comments">
                    <div class="like-count">üòäüòçÏ¢ãÏïÑÏöî <span class="like-count-value">{{likeCount}}</span></div>
                    <div class="comment-count">üí¨ÎåìÍ∏Ä {{replyCount}}</div>
                </div>
            </div>
        </div>
        <div class="comment-section-container">
            <button class="like-button {{#liked}}liked{{/liked}}" data-board-id="{{boardId}}">
                <i class="fas fa-heart"></i>
            </button>
            <div class="comment-section">
                <form action="/reply/save" method="post">
                    <img src="{{myProfileImage}}" alt="Commenter Picture" class="comment-picture">
                    <input type="text" name="comment" placeholder="ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî.">
                </form>
            </div>
            <button type="submit" class="send-button">Î≥¥ÎÇ¥Í∏∞</button>
        </div>
    {{/modals.boards}}

    {{#myBoardModel.myBoardList}}
        <div class="group-name">{{socialName}}</div>
        <div class="post">
            <div class="author-box">
                <img src="{{userImage}}" alt="Profile Picture" class="profile-picture openModalBtn"
                     data-board-id="{{boardId}}">
                <div>
                    <button data-board-id="{{boardId}}" class="book-button {{#book}}book{{/book}}">
                        <i class="fas fa-star" style="color: yellow"></i>
                    </button>
                    <div class="author">{{nickname}}</div>
                    <div class="date">{{createdAt}}</div>
                </div>
            </div>
            <div class="message-box">
                {{#albums}}
                    <div class="media-item">
                        {{#isImage}}
                            <img src="{{path}}" alt="Image"
                                 style="max-width: 100%; max-height: 300px; margin-bottom: 10px;">
                        {{/isImage}}
                        {{#isVideo}}
                            <video controls style="max-width: 100%; max-height: 300px;">
                                <source src="{{path}}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {{/isVideo}}
                    </div>
                {{/albums}}
                <div class="message openModalBtn" data-board-id="{{boardId}}">
                    {{{content}}}
                </div>
                {{^hashEmpty}}
                    <div class="media-box">
                        <div class="hashtag-box">
                            {{#hashtagList}}
                                <button class="hashtag-btn">{{name}}</button>
                            {{/hashtagList}}
                        </div>
                    </div>
                {{/hashEmpty}}
                <div class="comments">
                    <div class="like-count">üòäüòçÏ¢ãÏïÑÏöî <span class="like-count-value">{{likeCount}}</span></div>
                    <div class="comment-count">üí¨ÎåìÍ∏Ä {{replyCount}}</div>
                </div>
            </div>
        </div>
        <div class="comment-section-container">
            <button class="like-button {{#liked}}liked{{/liked}}" data-board-id="{{boardId}}">
                <i class="fas fa-heart"></i>
            </button>
            <div class="comment-section">
                <form action="/reply/save" method="post">
                    <img src="{{myProfileImage}}" alt="Commenter Picture" class="comment-picture">
                    <input type="text" name="comment" placeholder="ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî.">
                </form>
            </div>
            <button type="submit" class="send-button">Î≥¥ÎÇ¥Í∏∞</button>
        </div>
    {{/myBoardModel.myBoardList}}
</div>

<script>
    $(document).ready(function () {
        let modal = $("#boardModal");

        // Ï¢ãÏïÑÏöî Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        $('.bmodal-like-icon').on('click', function () {
            var likeCount = $(this).siblings('.bmodal-like-count');
            var count = parseInt(likeCount.text());
            if ($(this).hasClass('far')) {
                $(this).removeClass('far').addClass('fas');
                likeCount.text(count + 1);
            } else {
                $(this).removeClass('fas').addClass('far');
                likeCount.text(count - 1);
            }
        });

        // ÎåìÍ∏Ä ÏÇ≠Ï†ú Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        $(document).on('click', '.delete-comment-button', function () {
            var $comment = $(this).closest('.bmodal-board-comment, .bmodal-reply');
            var commentId = $comment.data('comment-id'); // ÎåìÍ∏Ä ID Í∞ÄÏ†∏Ïò§Í∏∞

            // ÏÑúÎ≤ÑÏóê ÏÇ≠Ï†ú ÏöîÏ≤≠
            $.ajax({
                type: 'DELETE',
                url: '/comment/delete?commentId=' + commentId, // URL Îß§Í∞úÎ≥ÄÏàòÎ°ú commentId Ï†ÑÏÜ°
                success: function (response) {
                    if (response.success) {
                        // ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÇ≠Ï†úÎêòÎ©¥ ÎåìÍ∏ÄÏùÑ UIÏóêÏÑú Ï†úÍ±∞
                        $comment.remove();
                    } else {
                        console.error('Error:', response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        });

        // Ï¢ãÏïÑÏöî Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        $(document).on('click', '.like-button', function () {
            var $this = $(this);
            var boardId = $this.data('board-id');
            var isLiked = $this.hasClass('liked');
            var method = isLiked ? 'DELETE' : 'POST';
            var url = isLiked ? '/like/delete' : '/like/save';

            // Ï¶âÏãú UI ÏóÖÎç∞Ïù¥Ìä∏
            $this.toggleClass('liked');
            $this.find('.fa-heart').css('color', isLiked ? '#aaaaaa' : 'red');

            // ÏÑúÎ≤ÑÏóê ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏöîÏ≤≠
            $.ajax({
                type: method,
                url: url + '?boardId=' + boardId, // URL Îß§Í∞úÎ≥ÄÏàòÎ°ú boardId Ï†ÑÏÜ°
                success: function (response) {
                    if (!response.success) {
                        // ÏÑúÎ≤Ñ ÏöîÏ≤≠Ïù¥ Ïã§Ìå®ÌïòÎ©¥ UIÎ•º Îã§Ïãú ÏõêÎûò ÏÉÅÌÉúÎ°ú ÎèåÎ¶º
                        $this.toggleClass('liked');
                        $this.find('.fa-heart').css('color', isLiked ? 'red' : '#aaaaaa');
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                    // ÏóêÎü¨Í∞Ä Î∞úÏÉùÌïòÎ©¥ UIÎ•º Îã§Ïãú ÏõêÎûò ÏÉÅÌÉúÎ°ú ÎèåÎ¶º
                    $this.toggleClass('liked');
                    $this.find('.fa-heart').css('color', isLiked ? 'red' : '#aaaaaa');
                }
            });
        });

        // Î∂ÅÎßàÌÅ¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        $(document).on('click', '.book-button', function () {
            var $this = $(this);
            var boardId = $this.data('board-id');
            var isBooked = $this.hasClass('book');
            var method = isBooked ? 'DELETE' : 'POST';
            var url = isBooked ? '/bookmark/delete' : '/bookmark/save';

            // Ï¶âÏãú UI ÏóÖÎç∞Ïù¥Ìä∏
            $this.toggleClass('book');
            $this.find('.fa-star').css('color', isBooked ? '#aaaaaa' : 'yellow');

            // ÏÑúÎ≤ÑÏóê ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ ÏöîÏ≤≠
            $.ajax({
                type: method,
                url: url + '?boardId=' + boardId, // URL Îß§Í∞úÎ≥ÄÏàòÎ°ú boardId Ï†ÑÏÜ°
                success: function (response) {
                    if (!response.success) {
                        // ÏÑúÎ≤Ñ ÏöîÏ≤≠Ïù¥ Ïã§Ìå®ÌïòÎ©¥ UIÎ•º Îã§Ïãú ÏõêÎûò ÏÉÅÌÉúÎ°ú ÎèåÎ¶º
                        $this.toggleClass('book');
                        $this.find('.fa-star').css('color', isBooked ? 'yellow' : '#aaaaaa');
                    } else {
                        // ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂ÅÎßàÌÅ¨ ÏÉÅÌÉúÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏Îêú Í≤ΩÏö∞, ÌéòÏù¥ÏßÄ Î¶¨Î°úÎìú
                        if (isBooked) {
                            location.reload(); // Î∂ÅÎßàÌÅ¨ ÏÇ≠Ï†ú ÏãúÏóêÎßå ÌéòÏù¥ÏßÄ Î¶¨Î°úÎìú
                        }
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                    // ÏóêÎü¨Í∞Ä Î∞úÏÉùÌïòÎ©¥ UIÎ•º Îã§Ïãú ÏõêÎûò ÏÉÅÌÉúÎ°ú ÎèåÎ¶º
                    $this.toggleClass('book');
                    $this.find('.fa-star').css('color', isBooked ? 'yellow' : '#aaaaaa');
                }
            });
        });

        // Î™®Îã¨ ÏºúÎäî Í∏∞Îä•
        $(document).on('click', '.openModalBtn', function () {
            console.log("Î≤ÑÌäº ÎàåÎ¶º");
            var boardId = $(this).data('board-id');
            $.ajax({
                url: '/board/detail/',
                method: 'GET',
                data: {boardId: boardId}, // RequestParamÏúºÎ°ú boardId Ï†ÑÏÜ°
                dataType: 'json',
                success: function (data) {
                    var detail = data;
                    var hashtagList = detail.hashtagList || []; // hashtagListÍ∞Ä ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥ ÏÇ¨Ïö©
                    var replyList = detail.replyList || []; // replyListÍ∞Ä ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥ ÏÇ¨Ïö©

                    var modalBodyHtml = `
               <div class="bmodal-user-info">
                    <img src="${detail.userImage}" alt="User Image" class="rounded-circle bmodal-user-image">
                    <div class="bmodal-user-details">
                        <strong>${detail.nickname}</strong>
                        <p class="bmodal-date">${detail.createdAt}</p>
                    </div>
                </div>
                <p>${detail.content}</p>
                <div class="bmodal-hashtags">
                    ${hashtagList.map(hashtag => `<span class="bmodal-hashtag">${hashtag.name}</span>`).join('')}
                </div>
                <div class="bmodal-board-actions">
                    <div class="bmodal-likes-comments">
                        <i class="far fa-heart bmodal-like-icon"></i>
                        <span>Ï¢ãÏïÑÏöî</span>
                        <span class="bmodal-like-count">${detail.likeCount}</span>
                    </div>
                    <div class="bmodal-likes-comments">
                        <i class="fas fa-comment bmodal-comment-icon"></i>
                        <span>ÎåìÍ∏ÄÏì∞Í∏∞</span>
                        <span class="bmodal-comment-count">${detail.replyCount}</span>
                    </div>
                </div>
                <div class="bmodal-board-comment-section">
    ${replyList.map(reply => `
        <div class="bmodal-board-comment" data-comment-id="${reply.id}">
            <div class="comment-content">
                <img src="${reply.userImage}" alt="Profile Picture" class="comment-profile-image">
                <div>
                    <strong>${reply.nickname}</strong>
                    <p>${reply.content}</p>
                    <div class="comment-meta">
                        <span class="comment-time">${reply.createdAt}</span>
                        <button class="reply-button">ÎãµÍ∏ÄÏì∞Í∏∞</button>
                    </div>
                </div>
                <button class="delete-comment-button" data-comment-id="${reply.id}">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
            <div class="bmodal-reply-section">
                ${reply.rereplyList.map(rereply => `
                    <div class="bmodal-board-comment bmodal-reply" data-comment-id="${rereply.id}">
                        <div class="comment-content">
                            <img src="${rereply.userImage}" alt="Profile Picture" class="reply-profile-image">
                            <div>
                                <strong>${rereply.nickname}</strong>
                                <p>${rereply.content}</p>
                                <div class="comment-meta">
                                    <span class="comment-time">${rereply.createdAt}</span>
                                    <button class="reply-button">ÎãµÍ∏ÄÏì∞Í∏∞</button>
                                </div>
                            </div>
                            <button class="delete-comment-button" data-comment-id="${rereply.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('')}
</div>
            `;
                    $('#boardModal .modal-body').html(modalBodyHtml);
                    $('#boardModal').css('display', 'block'); // Î™®Îã¨ÏùÑ ÌôîÎ©¥Ïóê ÌëúÏãú
                },
                error: function (xhr, status, error) {
                    console.error("AJAX Ïò§Î•ò:", error);
                }
            });
        });

        // Î™®Îã¨ Îã´Í∏∞ Í∏∞Îä•
        $('#closeModalBtn').on('click', function () {
            modal.css('display', 'none'); // Î™®Îã¨ÏùÑ ÌôîÎ©¥ÏóêÏÑú Ïà®ÍπÄ
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Î™®Îã¨ Îã´Í∏∞
        $(window).on('click', function (event) {
            if (event.target === modal[0]) {
                modal.css('display', 'none'); // Î™®Îã¨ÏùÑ ÌôîÎ©¥ÏóêÏÑú Ïà®ÍπÄ
            }
        });
    });


</script>