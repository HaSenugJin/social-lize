<div class="modal fade" id="boardSaveModal" tabindex="-1" aria-labelledby="boardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="boardModalLabel">글쓰기</h5>
                <button id="closeModalBtn" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/board/" method="post" id="boardForm" enctype="application/x-www-form-urlencoded">
                    <div class="mb-3">
                        <label for="content" class="form-label">내용</label>
                        <textarea class="form-control" id="content" name="content" rows="5"></textarea>
                    </div>
                    <div class="text-end">
                        <button type="submit" class="btn btn-primary">게시</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // 모달 내부 클릭 시 닫히지 않도록 설정
        $('#boardSaveModal .modal-content').on('click', function(event) {
            event.stopPropagation();
        });

        // 모달이 열릴 때 socialId 값을 가져와서 폼의 action 속성에 추가
        $('#boardSaveModal').on('show.bs.modal', function (event) {
            var socialId = getSocialIdFromUrl();
            var modal = $(this);
            var form = modal.find('form');
            form.attr('action', '/board/' + socialId);
        });

        // 폼 submit 이벤트 처리
        $('#boardForm').on('submit', function(event) {
            event.preventDefault(); // 폼이 실제로 제출되지 않도록 막음

            var form = $(this);
            var formData = form.serialize(); // 폼 데이터를 직렬화하여 변수에 저장

            // AJAX 요청을 보냄
            $.ajax({
                type: form.attr('method'),
                url: form.attr('action'),
                data: formData,
                success: function(response) {
                    console.log('게시 성공');
                    $('#boardSaveModal').modal('hide'); // 성공 시 모달 닫기
                    // 여기에 필요한 추가 작업을 수행할 수 있음
                },
                error: function(error) {
                    console.error('게시 에러', error);
                    // 실패 시 처리 로직 추가
                }
            });
        });

        // URL에서 socialId를 추출하는 함수
        function getSocialIdFromUrl() {
            var url = window.location.href; // 현재 페이지 URL 가져오기
            var matches = url.match(/\/social\/detail\/(\d+)/); // 정규 표현식으로 socialId 추출
            if (matches && matches.length > 1) {
                return matches[1]; // socialId 반환
            } else {
                return 1; // 기본값 설정 (추출 실패 시)
            }
        }
    });
</script>
