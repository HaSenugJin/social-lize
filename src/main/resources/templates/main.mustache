{{> layout/header}}

<div class="container">
    <div class="tab-nav">
        <button class="tab-button active" data-tab="mySocial">내 소셜</button>
        <button class="tab-button" data-tab="findSocial">소셜 찾기</button>
    </div>
    <div class="tab-content" id="mySocial">
        <div class="card-deck">
            <div class="card create-band-card">
                <div class="card-body text-center">
                    <i class="fas fa-plus-circle"></i>
                    <p class="card-text">만들기</p>
                </div>
            </div>
            {{#model.mySocialList}}
                <div class="card">
                    <img src="{{imagePath}}" class="card-img-top" alt="image">
                    <div class="card-body">
                        <h5 class="card-title truncate">{{title}}</h5>
                        <p class="card-text">{{memberCount}}</p>
                    </div>
                </div>
            {{/model.mySocialList}}
        </div>
        <div class="mt-4">
            <h3>내 소셜 인기글</h3>
            <div class="row">
                {{#model.mySocialPopularList}}
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body w-100">
                                <h5 class="card-title truncate2">{{title}}</h5>
                                <p class="card-text truncate">{{{content}}}</p>
                                <p class="card-text"><small class="text-muted">작성자: {{nickname}}</small></p>
                            </div>
                            <div class="card-footer">
                                <small class="text-muted">👍 {{likeCount}} 💬 {{replyCount}}</small>
                            </div>
                        </div>
                    </div>
                {{/model.mySocialPopularList}}
            </div>
        </div>
        <h3>주제별 소셜을 찾아보세요</h3>
        <div class="category-container">
            <button class="scroll-button" onclick="scrollLeft()">&#9664;</button>
            <div class="d-flex flex-nowrap overflow-auto category-wrap-vertical">
                {{#model.categoryList}}
                    <li class="category-item">
                        <button class="tab-button category-button" data-tab="findSocial" data-category-id="{{id}}">
                            <img src="{{imagePath}}" class="rounded-circle category-img" alt="...">
                            <h5 class="mt-2 text-center">{{name}}</h5>
                        </button>
                    </li>
                {{/model.categoryList}}
            </div>
            <button class="scroll-button" onclick="scrollRight()">&#9654;</button>
        </div>
        <div class="mt-2">
            <h3>오늘의 인기글</h3>
            <div class="row">
                {{#model.popularPostList}}
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title truncate2">{{title}}</h5>
                                <p class="card-text truncate">{{{content}}}</p>
                                <p class="card-text"><small class="text-muted">작성자: {{nickname}}</small></p>
                            </div>
                            <div class="card-footer">
                                <small class="text-muted">👍 {{likeCount}} 💬 {{replyCount}}</small>
                            </div>
                        </div>
                    </div>
                {{/model.popularPostList}}
            </div>
        </div>
    </div>

    <div class="tab-content" id="findSocial" style="display: none;">
        <h3>주제별 소셜을 찾아보세요</h3>
        <div class="category-container">
            <button class="scroll-button" onclick="scrollLeft()">&#9664;</button>
            <div class="d-flex flex-nowrap overflow-auto category-wrap-vertical">
                {{#model.categoryList}}
                    <li class="category-item">
                        <button class="tab-button category-button" data-tab="findSocial" data-category-id="{{id}}">
                            <img src="{{imagePath}}" class="rounded-circle category-img" alt="...">
                            <h5 class="mt-2 text-center">{{name}}</h5>
                        </button>
                    </li>
                {{/model.categoryList}}
            </div>
            <button class="scroll-button" onclick="scrollRight()">&#9654;</button>
        </div>
        <div class="category-social-list row mt-4">

        </div>
    </div>
</div>



<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabButtons = document.querySelectorAll('.tab-button'); // 모든 탭 버튼 가져오기
        const tabContents = document.querySelectorAll('.tab-content'); // 모든 탭 콘텐츠 가져오기

        // 탭 버튼 클릭 시 처리하는 함수
        function handleTabButtonClick(button) {
            // 모든 버튼에서 'active' 클래스 제거
            tabButtons.forEach(btn => btn.classList.remove('active'));
            // 클릭된 버튼에 'active' 클래스 추가
            button.classList.add('active');

            // 클릭된 버튼에 해당하는 탭 ID 가져오기
            const tabId = button.getAttribute('data-tab');
            if (tabId) {
                // 모든 탭 콘텐츠 숨기기
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });

                // 클릭된 버튼에 해당하는 콘텐츠 보이기
                const tabContent = document.getElementById(tabId);

                // 탭 네비게이션에 파란색 줄 추가
                const tabNav = document.querySelector('.tab-nav');
                if (tabContent) {
                    tabContent.style.display = 'block';

                } else {
                    console.error(`Tab content with ID '${tabId}' not found.`);
                }
            } else {
                console.error('Button does not have data-tab attribute.');
            }
        }

        // 모든 탭 버튼에 클릭 이벤트 리스너 등록
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                handleTabButtonClick(button);

                // 만약 클릭된 버튼의 data-tab 값이 'findSocial'이면 소셜 찾기 버튼에 active 클래스 추가
                if (button.getAttribute('data-tab') === 'findSocial') {
                    document.querySelector('.tab-button[data-tab="findSocial"]').classList.add('active');
                }
            });
        });


        // 페이지 로드 시 첫 번째 탭 기본으로 보이게 함
        document.querySelector('.tab-button').click();

        // 카테고리 버튼 클릭 시 AJAX 요청 처리
        document.querySelectorAll('.category-item button').forEach(button => {
            button.addEventListener('click', function () {
                const categoryId = this.getAttribute('data-category-id');

                $.ajax({
                    url: "/main/category",
                    type: "GET",
                    data: {categoryId: categoryId},
                    success: function (response) {
                        const socialList = response; // 서버에서 반환된 소셜 리스트
                        console.log(response);
                        const categorySocialList = document.querySelector('.category-social-list');

                        // 기존 소셜 리스트 초기화
                        categorySocialList.innerHTML = '';

                        // 새로운 소셜 리스트 추가
                        socialList.forEach(social => {
                            const socialCard = `
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-body d-flex justify-content-center">
                                        <div>
                                            <img src="${social.image}" alt="이미지">
                                        </div>
                                        <div>
                                            <h5 class="card-title truncate2">${social.name}</h5>
                                            <p class="card-text truncate2">${social.info}</p>
                                            <p class="card-text"><small class="text-muted">멤버수 : ${social.memberCount}<br>리더이름 : ${social.nickName}</small></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            `;
                            categorySocialList.innerHTML += socialCard;
                        });
                    },
                    error: function (error) {
                        alert('소셜 목록을 불러오는 데 실패했습니다.');
                    }
                });
            });
        });
    });
</script>

{{> layout/footer}}
