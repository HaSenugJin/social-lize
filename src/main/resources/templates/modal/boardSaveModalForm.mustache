<div class="modal fade" id="boardSaveModal" tabindex="-1" aria-labelledby="boardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="boardModalLabel">글쓰기</h5>
                <button id="closeModalBtn" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/board/" method="post" id="boardForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <!-- 텍스트 에디터 -->
                        <input id="content" contenteditable="true"
                             style="padding: 5px 15px; border: 1px solid #D6D6D6; border-radius: 4px; height: 300px; overflow-y: auto;">

                        <!-- 이미지 및 비디오 파일 선택 -->
                        <input name="imgFiles" id="imgFiles" type="file" style="border-radius: 4px; margin-top: 8px" accept="image/*" multiple>
                        <input name="videoFiles" id="videoFiles" type="file" style="border-radius: 4px; margin-top: 8px" accept="video/*" multiple>
                    </div>
                    <div class="text-end">
                        <button type="submit" class="btn btn-primary">게시</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // 모달 내부 클릭 시 닫히지 않도록 설정
        $('#boardSaveModal .modal-content').on('click', function (event) {
            event.stopPropagation();
        });

        // 모달이 열릴 때 socialId 값을 가져와서 폼의 action 속성에 추가
        $('#boardSaveModal').on('show.bs.modal', function (event) {
            var socialId = getSocialIdFromUrl();
            var modal = $(this);
            var form = modal.find('form');
            form.attr('action', '/board/' + socialId);
        });

        // URL에서 socialId를 추출하는 함수
        function getSocialIdFromUrl() {
            var url = window.location.href; // 현재 페이지 URL 가져오기
            var matches = url.match(/\/social\/detail\/(\d+)/); // 정규 표현식으로 socialId 추출
            if (matches && matches.length > 1) {
                return matches[1]; // socialId 반환
            } else {
                return 1; // 기본값 설정 (추출 실패 시)
            }
        }

        // 이미지 및 동영상 미리보기 기능
        $('#imgFiles, #videoFiles').change(function (event) {
            const content = document.getElementById('content');
            const files = this.files;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const mediaContainer = document.createElement('div');
                        mediaContainer.style.display = 'inline-block';
                        mediaContainer.style.margin = '10px';

                        if (file.type.startsWith('image')) {
                            // 이미지 파일 처리
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.style.width = '250px';
                            img.style.height = '250px';
                            mediaContainer.appendChild(img);
                        } else if (file.type.startsWith('video')) {
                            // 동영상 파일 처리
                            const video = document.createElement('video');
                            video.src = e.target.result;
                            video.style.width = '250px';
                            video.style.height = '250px';
                            video.controls = true; // 비디오 컨트롤러 표시
                            mediaContainer.appendChild(video);
                        }

                        content.appendChild(mediaContainer);
                    };
                    reader.readAsDataURL(file);
                }
            }
            // 파일 입력 후 초기화
            this.value = "";
        });
    });

</script>
